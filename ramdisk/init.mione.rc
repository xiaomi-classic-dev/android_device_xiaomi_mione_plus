# init.mione.rc
# init script for xiaomi mione
#
# Author: Tommy Alex
# Create: 2012-11-23 13:03


import init.qcom.rc

# most of the following are from boot.img of mioneplus_QDS81

on init
    mkdir /mnt/shell/emulated 0700 shell shell
    mkdir /storage/emulated 0555 root root
    export EXTERNAL_STORAGE /storage/emulated/legacy
    export EMULATED_STORAGE_SOURCE /mnt/shell/emulated
    export EMULATED_STORAGE_TARGET /storage/emulated
    mkdir /vendor/firmware 0775 system system

on fs
    setprop ro.crypto.fuse_sdcard true

on boot
    chown system system /sys/class/leds/backlight/brightness
    chown system system /sys/class/leds/flashlight/brightness
    chmod 0666 /sys/class/leds/flashlight/brightness
    chown system system /sys/class/leds/torch-flash/brightness
    chown system system /sys/class/timed_output/vibrator/pattern

# Assign TCP buffer thresholds to be ceiling value of technology maximums
# Increased technology maximums should be reflected here.
    write /proc/sys/net/core/rmem_max  3461120
    write /proc/sys/net/core/wmem_max  3461120

    chmod 0444 /proc/cmdline

    class_start late_start

on fs
# mount mmc partitions
    mount_all ./fstab.mione
    #Setting permissons for misc partition
    chmod 0666 /dev/block/platform/msm_sdcc.1/by-name/misc

# modem firmware
    mount vfat /dev/block/mmcblk0p1 /firmware ro shortname=lower
# make modem firmware available at /vendor/firmware/image ( /vendor symlink to /system/vendor )
    mkdir /system/vendor/firmware/ 0755 system system
    symlink /firmware/image /system/vendor/firmware/image
    exec /system/bin/sh /system/etc/init.qcom.modem_links.sh

on post-fs-data
# double check /data/radio
    mkdir /data/radio 0770 radio radio
    chmod 2770 /data/radio
# support for hostapd
    mkdir /data/misc/wifi/hostapd 0777 wifi wifi

# InputMethodManagerService
    mkdir /data/system/inputmethod 0755 system system

    # no selinux
    stop auditd

on charger
    mount ext4 /dev/block/platform/msm_sdcc.1/by-name/system /system wait ro barrier=1
    write /sys/module/rpm_resources/enable_low_power/L2_cache 1
    write /sys/module/rpm_resources/enable_low_power/pxo 1
    write /sys/module/rpm_resources/enable_low_power/vdd_dig 2
    write /sys/module/rpm_resources/enable_low_power/vdd_mem 2
    write /sys/module/rpm_resources/enable_low_power/rpm_cpu 1
    write /sys/module/pm_8x60/modes/cpu0/power_collapse/suspend_enabled 1
    write /sys/module/pm_8x60/modes/cpu1/power_collapse/suspend_enabled 1
    write /sys/module/pm_8x60/modes/cpu0/standalone_power_collapse/suspend_enabled 1
    write /sys/module/pm_8x60/modes/cpu1/standalone_power_collapse/suspend_enabled 1
    write /sys/module/pm_8x60/modes/cpu0/power_collapse/idle_enabled 1
    write /sys/module/pm_8x60/modes/cpu1/power_collapse/idle_enabled 1
    write /sys/module/pm_8x60/modes/cpu0/standalone_power_collapse/idle_enabled 1
    write /sys/module/pm_8x60/modes/cpu1/standalone_power_collapse/idle_enabled 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "userspace"
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq 192000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_setspeed 192000
    write /sys/devices/system/cpu/cpu1/online 0
    setprop sys.usb.config adb


service chargeonlymode /sbin/chargeonlymode
    class charger


on property:sys.mione.battlevel=low
    stop thermald
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu1/cpufreq/scaling_max_freq 594000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 972000
    write /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk 200000000


on property:sys.mione.battlevel=high
    write /sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/max_gpuclk 266667000
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq 2000000
    write /sys/devices/system/cpu/cpu1/online 1
    write /sys/devices/system/cpu/cpu1/cpufreq/scaling_max_freq 2000000
    start thermald
